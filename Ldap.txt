
def ldap_login(username, password):
    # Modify the LDAP server details accordingly
    ldap_server = Server('ldap://dc-1.tvedc.local:389', get_info=ALL)
    # Replace the base_dn with your LDAP base DN
    base_dn = 'OU=Tvedc.local,DC=tvedc,DC=local'
    # Replace the search_filter with your LDAP search filter
    search_filter = '(sAMAccountName={})'.format(username)

    try:
        # Attempt to bind to the LDAP server
        conn = Connection(ldap_server, user='{}@tvedc.local'.format(username), password=password, authentication=SIMPLE)
        if not conn.bind():
            print(Fore.RED + "Login failed: Invalid credentials")
            return False

        # Search for the user in LDAP
        conn.search(search_base=base_dn, search_filter=search_filter, attributes=['cn'])
        if not conn.entries:
            print(Fore.RED + "Login failed: User not found")
            return False

        print(Fore.GREEN + "Login successful!")
        return True

    except Exception as e:
        print(Fore.RED + "An error occurred during LDAP authentication:", e)
        return False

def clear_screen():
    if platform.system() == "Windows":
        import os
        os.system("cls")
    else:
        import subprocess
        subprocess.call("clear", shell=True)

def get_password(prompt='Enter your password: '):
    if platform.system() == 'Windows':
        password = ''
        print(prompt, end='', flush=True)
        while True:
            char = msvcrt.getch()
            if char == b'\r':
                print()
                break
            elif char == b'\x08':  # Backspace
                if password:
                    password = password[:-1]
                    print('\b \b', end='', flush=True)
            else:
                password += char.decode('utf-8')
                print('*', end='', flush=True)
    else:
        password = getpass.getpass(prompt)
    return password

if __name__ == "__main__":
    clear_screen()
    init(autoreset=True)  # Initialize colorama

    input_username = input("Enter your username: ")
    input_password = get_password()

    if ldap_login(input_username, input_password):
        main()